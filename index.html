<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>配達ドリルトラッカー</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #050816;
      --card: #141a2b;
      --accent: #3ba9ff;
      --accent-soft: #234567;
      --gold: #ffd700;
      --text: #f5f5f5;
      --muted: #9ca3af;
      --danger: #f97373;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 12px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #182848 0, #050816 55%, #02030a 100%);
      color: var(--text);
    }
    h1 {
      font-size: 20px;
      margin: 0 0 4px;
    }
    .sub {
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 10px;
    }
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      grid-template-rows: auto auto auto;
      gap: 8px;
      margin-bottom: 4px;
    }
    .dash-item {
      padding: 6px 8px;
      border-radius: 10px;
      background: rgba(15,23,42,0.8);
      border: 1px solid rgba(148,163,184,0.2);
    }
    .dash-label {
      font-size: 10px;
      color: var(--muted);
    }
    .dash-value {
      font-size: 16px;
      font-weight: 600;
    }
    .dash-total-row {
      grid-column: 1 / 3;
      padding: 6px 8px;
      border-radius: 10px;
      background: radial-gradient(circle at top, #3b82f6 0, #020617 55%);
      border: 1px solid rgba(59,130,246,0.5);
    }
    .dash-total-row .dash-label {
      font-size: 11px;
      color: #e5e7eb;
    }
    .dash-total-row .dash-value {
      font-size: 20px;
      color: var(--gold);
    }

    .card {
      background: linear-gradient(135deg, rgba(20,26,43,0.95), rgba(9,12,24,0.98));
      border-radius: 14px;
      padding: 12px;
      box-shadow: 0 18px 35px rgba(0,0,0,0.8);
      border: 1px solid rgba(59,169,255,0.1);
      backdrop-filter: blur(10px);
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 6px;
    }
    .label {
      font-size: 11px;
      color: var(--muted);
    }
    .class-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 2px;
    }
    .class-meta {
      font-size: 11px;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      gap: 4px;
    }
    .pill {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      color: var(--muted);
    }
    .row {
      display: flex;
      gap: 8px;
      margin-bottom: 6px;
    }
    .row > div { flex: 1; }

    input[type="number"], select, textarea {
      width: 100%;
      padding: 8px 9px;
      border-radius: 10px;
      border: 1px solid #1e293b;
      background: rgba(15,23,42,0.9);
      color: var(--text);
      font-size: 12px;
      outline: none;
    }
    input::placeholder { color: #6b7280; }

    button {
      width: 100%;
      padding: 8px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(90deg, #22c55e, #06b6d4);
      color: white;
      font-weight: 600;
      font-size: 13px;
      box-shadow: 0 8px 18px rgba(16,185,129,0.55);
      cursor: pointer;
      margin-top: 4px;
    }
    button:active {
      transform: translateY(1px);
      box-shadow: 0 4px 10px rgba(16,185,129,0.45);
    }

    .status-line {
      font-size: 11px;
      color: var(--muted);
      margin-top: 4px;
    }
    .status-line span { margin-right: 6px; }

    .progress-bar {
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: #020617;
      overflow: hidden;
      margin-top: 6px;
    }
    .progress-inner {
      height: 100%;
      width: 0%;
      border-radius: inherit;
      background: linear-gradient(90deg, #3ba9ff, #22c55e);
      transition: width 0.25s ease-out;
    }

    .btn-row {
      display: flex;
      gap: 8px;
      margin-top: 4px;
    }
    .btn-row button {
      width: 100%;
      font-size: 12px;
      padding: 7px;
    }
    .btn-quest {
      background: linear-gradient(90deg, #3b82f6, #06b6d4);
      box-shadow: 0 8px 18px rgba(59,130,246,0.55);
    }
    .btn-cash {
      background: linear-gradient(90deg, #f97316, #facc15);
      box-shadow: 0 8px 18px rgba(249,115,22,0.55);
    }
  </style>
</head>
<body>
  <h1>配達ドリルトラッカー</h1>
  <div class="sub">クラスはあくまで目安。金額・時間・件数は毎回手打ちで記録していく。</div>

  <!-- トップダッシュボード -->
  <div class="card">
    <div class="dashboard-grid">
      <div class="dash-item">
        <div class="dash-label">ドリル進捗</div>
        <div class="dash-value"><span id="totalRuns">0</span> / 35回</div>
      </div>
      <div class="dash-item">
        <div class="dash-label">総配達件数</div>
        <div class="dash-value"><span id="totalDeliveries">0</span>件</div>
      </div>
      <div class="dash-item">
        <div class="dash-label">クエスト合計</div>
        <div class="dash-value">¥<span id="questTotalTop">0</span></div>
      </div>
      <div class="dash-item">
        <div class="dash-label">現金回収合計</div>
        <div class="dash-value">¥<span id="cashTotalTop">0</span></div>
      </div>
      <div class="dash-total-row">
        <div class="dash-label">総売上 (クエスト・現金込み)</div>
        <div class="dash-value">¥<span id="totalAmount">0</span></div>
      </div>
    </div>
    <div class="label" style="margin-top:6px;">ドリル達成度</div>
    <div class="progress-bar">
      <div id="drillProgress" class="progress-inner"></div>
    </div>
  </div>

  <!-- 1500円クラス -->
  <div class="card" style="margin-top:10px;">
    <div class="card-header">
      <div>
        <div class="class-title">1500円クラス</div>
        <div class="class-meta">
          <span>目安: 1500円 / 40分 / 件</span>
          <span>目標 2回 (クラスドリル)</span>
        </div>
      </div>
      <div class="pill">クラス進捗: <span id="runs1500">0</span>回</div>
    </div>

    <div class="row" style="margin-top:6px;">
      <div>
        <div class="label">金額 (円)</div>
        <input type="number" id="inputAmount1500" placeholder="例: 1640" min="0" />
      </div>
      <div>
        <div class="label">時間 (分)</div>
        <input type="number" id="inputTime1500" placeholder="例: 40" min="0" />
      </div>
      <div>
        <div class="label">現金回収 (円)</div>
        <input type="number" id="inputCash1500" placeholder="例: 200" min="0" />
      </div>
      <div>
        <div class="label">件数 (件)</div>
        <select id="inputCount1500">
          <option value="1">1</option>
          <option value="2" selected>2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </div>
    </div>
    <button onclick="addClassRun('1500')">追加</button>
    <div class="status-line">
      <span>達成回数: <span id="doneRuns1500">0</span> / 2回</span>
      <span>実配達件数: <span id="delivered1500">0</span>件</span>
      <span>クラス合計: ¥<span id="amount1500">0</span></span>
      <span>時間合計: <span id="time1500">0</span>分</span>
    </div>
    <div class="progress-bar">
      <div id="progress1500" class="progress-inner"></div>
    </div>
  </div>

  <!-- 1000円クラス -->
  <div class="card" style="margin-top:10px;">
    <div class="card-header">
      <div>
        <div class="class-title">1000円クラス</div>
        <div class="class-meta">
          <span>目安: 1000円 / 30分 / 件</span>
          <span>目標 6回 (クラスドリル)</span>
        </div>
      </div>
      <div class="pill">クラス進捗: <span id="runs1000">0</span>回</div>
    </div>

    <div class="row" style="margin-top:6px;">
      <div>
        <div class="label">金額 (円)</div>
        <input type="number" id="inputAmount1000" placeholder="例: 1050" min="0" />
      </div>
      <div>
        <div class="label">時間 (分)</div>
        <input type="number" id="inputTime1000" placeholder="例: 30" min="0" />
      </div>
      <div>
        <div class="label">現金回収 (円)</div>
        <input type="number" id="inputCash1000" placeholder="例: 150" min="0" />
      </div>
      <div>
        <div class="label">件数 (件)</div>
        <select id="inputCount1000">
          <option value="1">1</option>
          <option value="2" selected>2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </div>
    </div>
    <button onclick="addClassRun('1000')">追加</button>
    <div class="status-line">
      <span>達成回数: <span id="doneRuns1000">0</span> / 6回</span>
      <span>実配達件数: <span id="delivered1000">0</span>件</span>
      <span>クラス合計: ¥<span id="amount1000">0</span></span>
      <span>時間合計: <span id="time1000">0</span>分</span>
    </div>
    <div class="progress-bar">
      <div id="progress1000" class="progress-inner"></div>
    </div>
  </div>

  <!-- 600円クラス -->
  <div class="card" style="margin-top:10px;">
    <div class="card-header">
      <div>
        <div class="class-title">600円クラス</div>
        <div class="class-meta">
          <span>目安: 600円 / 20分 / 件</span>
          <span>残り時間をこのクラスで埋める</span>
        </div>
      </div>
      <div class="pill">クラス進捗: <span id="runs600">0</span>回</div>
    </div>

    <div class="row" style="margin-top:6px;">
      <div>
        <div class="label">金額 (円)</div>
        <input type="number" id="inputAmount600" placeholder="例: 620" min="0" />
      </div>
      <div>
        <div class="label">時間 (分)</div>
        <input type="number" id="inputTime600" placeholder="例: 20" min="0" />
      </div>
      <div>
        <div class="label">現金回収 (円)</div>
        <input type="number" id="inputCash600" placeholder="例: 100" min="0" />
      </div>
      <div>
        <div class="label">件数 (件)</div>
        <select id="inputCount600">
          <option value="1" selected>1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </div>
    </div>
    <button onclick="addClassRun('600')">追加</button>
    <div class="status-line">
      <span>達成回数: <span id="doneRuns600">0</span> / 30回</span>
      <span>実配達件数: <span id="delivered600">0</span>件</span>
      <span>クラス合計: ¥<span id="amount600">0</span></span>
      <span>時間合計: <span id="time600">0</span>分</span>
      <span>推奨回数目安: <span id="suggest600" style="color:var(--gold);">0</span>回</span>
    </div>
    <div class="progress-bar">
      <div id="progress600" class="progress-inner"></div>
    </div>
  </div>

  <!-- カスタムクラス -->
  <div class="card" style="margin-top:10px;">
    <div class="card-header">
      <div>
        <div class="class-title">カスタム</div>
        <div class="class-meta">
          <span>金額 & 時間が特殊な案件用</span>
        </div>
      </div>
      <div class="pill">回数: <span id="runsCustom">0</span>回</div>
    </div>
    <div class="row" style="margin-top:6px;">
      <div>
        <div class="label">金額 (円)</div>
        <input type="number" id="inputCustomAmount" placeholder="例: 2500" min="0" />
      </div>
      <div>
        <div class="label">時間 (分)</div>
        <input type="number" id="inputCustomTime" placeholder="例: 45" min="0" />
      </div>
      <div>
        <div class="label">現金回収 (円)</div>
        <input type="number" id="inputCustomCash" placeholder="例: 300" min="0" />
      </div>
      <div>
        <div class="label">件数 (件)</div>
        <select id="inputCustomCount">
          <option value="1" selected>1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </div>
    </div>
    <button onclick="addCustom()">追加</button>
    <div class="status-line">
      <span>実配達件数: <span id="deliveredCustom">0</span>件</span>
      <span>クラス合計: ¥<span id="amountCustom">0</span></span>
      <span>平均単価: ¥<span id="avgCustom">0</span></span>
      <span>時間合計: <span id="timeCustom">0</span>分</span>
    </div>
  </div>

  <!-- クエスト & 今日のメモ & 現金回収 -->
  <div class="card" style="margin-top:10px; margin-bottom:10px;">
    <div class="class-title">クエスト & 今日のメモ & 現金回収</div>
    <div class="row" style="margin-top:6px;">
      <div>
        <div class="label">クエスト金額 (円)</div>
        <input type="number" id="inputQuest" placeholder="例: 1200" min="0" />
      </div>
      <div>
        <div class="label">現金回収 (円)</div>
        <input type="number" id="inputCash" placeholder="例: 500" min="0" />
      </div>
    </div>
    <div class="btn-row">
      <button class="btn-quest" onclick="addQuest()">クエストを追加</button>
      <button class="btn-cash" onclick="addCash()">現金回収を追加</button>
    </div>
    <div class="status-line">
      <span>クエスト合計: ¥<span id="questOnly">0</span></span>
      <span>現金回収合計: ¥<span id="cashOnly">0</span></span>
    </div>
    <div class="label" style="margin-top:6px;">今日のメモ（雨 / 休日 / ブースト など）</div>
    <textarea id="dailyNote" placeholder="例: 雨クエ中 / 夕方からブースト強め など"></textarea>
  </div>

  <!-- リセットボタン -->
  <div class="card" style="margin-top:8px; margin-bottom:8px; text-align:center;">
    <div class="label" style="margin-bottom:4px;">今日の記録を全部リセット</div>
    <button onclick="resetAll()" style="max-width:260px; margin:0 auto; background:linear-gradient(90deg,#ef4444,#f97316);">
      全リセット（件数・金額・メモ）
    </button>
  </div>

  <!-- 更新ボタン -->
  <div class="card" style="margin-top:8px; margin-bottom:24px; text-align:center;">
    <div class="label" style="margin-bottom:4px;">コード更新後に押す用</div>
    <button onclick="location.reload()" style="max-width:260px; margin:0 auto;">
      ページを更新（最新コードを読み込む）
    </button>
  </div>

  <script>
    const STATE_KEY = "deliveryDrillState_v6";

    let state = {
      runs:      { "1500": 0, "1000": 0, "600": 0, custom: 0 },
      delivered: { "1500": 0, "1000": 0, "600": 0, custom: 0 },
      amounts:   { "1500": 0, "1000": 0, "600": 0, custom: 0 },
      times:     { "1500": 0, "1000": 0, "600": 0, custom: 0 },
      quest: 0,
      cash:  0,
      note:  ""
    };

    function loadState() {
      try {
        const raw = localStorage.getItem(STATE_KEY);
        if (raw) state = Object.assign(state, JSON.parse(raw));
      } catch(e) {}
    }

    function saveState() {
      localStorage.setItem(STATE_KEY, JSON.stringify(state));
    }

    function calcTotals() {
      const totalRuns =
        state.runs["1500"] + state.runs["1000"] + state.runs["600"] + state.runs.custom;
      const totalDeliveries =
        state.delivered["1500"] + state.delivered["1000"] +
        state.delivered["600"] + state.delivered.custom;
      const totalClassAmount =
        state.amounts["1500"] + state.amounts["1000"] +
        state.amounts["600"] + state.amounts.custom;
      const totalAmount = totalClassAmount + state.quest + state.cash;

      document.getElementById("totalRuns").textContent = totalRuns;
      document.getElementById("totalDeliveries").textContent = totalDeliveries;
      document.getElementById("totalAmount").textContent = totalAmount.toLocaleString();

      document.getElementById("questTotalTop").textContent = state.quest.toLocaleString();
      document.getElementById("cashTotalTop").textContent  = state.cash.toLocaleString();

      const drillPercent = Math.min(100, (totalRuns / 35) * 100);
      document.getElementById("drillProgress").style.width = drillPercent + "%";

      document.getElementById("runs1500").textContent = state.runs["1500"];
      document.getElementById("runs1000").textContent = state.runs["1000"];
      document.getElementById("runs600").textContent  = state.runs["600"];
      document.getElementById("runsCustom").textContent = state.runs.custom;

      document.getElementById("doneRuns1500").textContent = state.runs["1500"];
      document.getElementById("doneRuns1000").textContent = state.runs["1000"];
      document.getElementById("doneRuns600").textContent  = state.runs["600"];

      ["1500","1000","600","custom"].forEach(k => {
        const delEl  = document.getElementById("delivered" + k);
        const amtEl  = document.getElementById("amount" + k);
        const timeEl = document.getElementById("time" + k);
        if (delEl)  delEl.textContent  = state.delivered[k].toString();
        if (amtEl)  amtEl.textContent  = state.amounts[k].toLocaleString();
        if (timeEl) timeEl.textContent = state.times[k].toString();
      });

      const p1500 = Math.min(100, (state.runs["1500"] / 2) * 100);
      const p1000 = Math.min(100, (state.runs["1000"] / 6) * 100);
      const p600  = Math.min(100, (state.runs["600"]  / 30) * 100);
      document.getElementById("progress1500").style.width = p1500 + "%";
      document.getElementById("progress1000").style.width = p1000 + "%";
      document.getElementById("progress600").style.width  = p600 + "%";

      const usedTime =
        state.times["1500"] + state.times["1000"] +
        state.times["600"] + state.times.custom;
      const targetTime = 750; // 12.5時間
      const remain = Math.max(0, targetTime - usedTime);
      const suggest = Math.floor(remain / 20); // 600クラス20分目安
      document.getElementById("suggest600").textContent = suggest;

      document.getElementById("deliveredCustom").textContent = state.delivered.custom.toString();
      document.getElementById("amountCustom").textContent    = state.amounts.custom.toLocaleString();
      document.getElementById("timeCustom").textContent      = state.times.custom.toString();
      const avg = state.delivered.custom
        ? Math.round(state.amounts.custom / state.delivered.custom)
        : 0;
      document.getElementById("avgCustom").textContent = avg.toLocaleString();

      document.getElementById("questOnly").textContent = state.quest.toLocaleString();
      document.getElementById("cashOnly").textContent  = state.cash.toLocaleString();
      document.getElementById("dailyNote").value       = state.note;
    }

    function addClassRun(key) {
      const amountInput = document.getElementById("inputAmount" + key);
      const timeInput   = document.getElementById("inputTime" + key);
      const cashInput   = document.getElementById("inputCash" + key);
      const countSelect = document.getElementById("inputCount" + key);

      const amount = parseInt(amountInput.value || "0", 10);
      const time   = parseInt(timeInput.value   || "0", 10);
      const cash   = parseInt(cashInput.value   || "0", 10);
      const count  = parseInt(countSelect.value || "0", 10);

      if (!count || count <= 0) return;
      if (!amount || amount < 0) return;

      state.runs[key]      += 1;
      state.delivered[key] += count;       // 件数だけ
      state.amounts[key]   += amount;      // 金額は入力そのもの
      if (time && time > 0) {
        state.times[key] += time;          // 時間も入力そのもの
      }
      if (cash && cash > 0) {
        state.cash += cash;                // 現金回収は全体cashへ
      }

      amountInput.value = "";
      timeInput.value   = "";
      cashInput.value   = "";
      flashKey(key);
      saveState();
      calcTotals();
    }

    function addCustom() {
      const amount = parseInt(document.getElementById("inputCustomAmount").value || "0", 10);
      const time   = parseInt(document.getElementById("inputCustomTime").value   || "0", 10);
      const cash   = parseInt(document.getElementById("inputCustomCash").value   || "0", 10);
      const count  = parseInt(document.getElementById("inputCustomCount").value  || "0", 10);
      if (!count || count <= 0) return;
      if (!amount || amount < 0) return;

      state.runs.custom      += 1;
      state.delivered.custom += count;
      state.amounts.custom   += amount;
      if (time && time > 0) {
        state.times.custom += time;
      }
      if (cash && cash > 0) {
        state.cash += cash;
      }

      document.getElementById("inputCustomAmount").value = "";
      document.getElementById("inputCustomTime").value   = "";
      document.getElementById("inputCustomCash").value   = "";
      flashKey("Custom");
      saveState();
      calcTotals();
    }

    function addQuest() {
      const q = parseInt(document.getElementById("inputQuest").value || "0", 10);
      if (!q || q <= 0) return;
      state.quest += q;
      document.getElementById("inputQuest").value = "";
      saveState();
      calcTotals();
    }

    function addCash() {
      const c = parseInt(document.getElementById("inputCash").value || "0", 10);
      if (!c || c <= 0) return;
      state.cash += c;
      document.getElementById("inputCash").value = "";
      saveState();
      calcTotals();
    }

    function resetAll() {
      if (!confirm("本当に今日の記録を全部リセットしますか？")) return;
      state = {
        runs:      { "1500": 0, "1000": 0, "600": 0, custom: 0 },
        delivered: { "1500": 0, "1000": 0, "600": 0, custom: 0 },
        amounts:   { "1500": 0, "1000": 0, "600": 0, custom: 0 },
        times:     { "1500": 0, "1000": 0, "600": 0, custom: 0 },
        quest: 0,
        cash:  0,
        note:  ""
      };
      saveState();
      calcTotals();
    }

    function flashKey(key) {
      const el =
        key === "1500" ? document.getElementById("progress1500")
        : key === "1000" ? document.getElementById("progress1000")
        : key === "600"  ? document.getElementById("progress600")
        : document.getElementById("runsCustom");
      if (!el) return;
      const original = el.style.boxShadow;
      el.style.boxShadow = "0 0 12px rgba(250,204,21,0.8)";
      setTimeout(() => { el.style.boxShadow = original; }, 220);
    }

    document.getElementById("dailyNote").addEventListener("input", () => {
      state.note = document.getElementById("dailyNote").value;
      saveState();
    });

    loadState();
    calcTotals();
  </script>
</body>
</html>
