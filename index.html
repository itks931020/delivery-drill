<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>é…é”ãƒ‰ãƒªãƒ«ãƒˆãƒ©ãƒƒã‚«ãƒ¼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #050816;
      --card: #141a2b;
      --accent: #3ba9ff;
      --accent-soft: #234567;
      --gold: #ffd700;
      --text: #f5f5f5;
      --muted: #9ca3af;
      --danger: #f97373;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 12px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #182848 0, #050816 55%, #02030a 100%);
      color: var(--text);
    }
    h1 {
      font-size: 20px;
      margin: 0 0 4px;
    }
    .sub {
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 10px;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      grid-template-rows: auto auto auto auto;
      gap: 8px;
      margin-bottom: 4px;
    }
    .dash-item {
      padding: 6px 8px;
      border-radius: 10px;
      background: rgba(15,23,42,0.8);
      border: 1px solid rgba(148,163,184,0.2);
    }
    .dash-label {
      font-size: 10px;
      color: var(--muted);
    }
    .dash-value {
      font-size: 16px;
      font-weight: 600;
      display:flex;
      align-items:baseline;
      gap:6px;
    }

    .dash-total-row {
      grid-column: 1 / 3;
      padding: 8px 10px;
      border-radius: 10px;
      background: radial-gradient(circle at top, #3b82f6 0, #020617 55%);
      border: 1px solid rgba(59,130,246,0.5);
    }
    .dash-total-row .dash-label {
      font-size: 11px;
      color: #e5e7eb;
      text-align:center; /* 6: ã‚»ãƒ³ã‚¿ãƒ¼ */
    }
    .dash-total-row .dash-value {
      font-size: 20px;
      color: var(--gold);
      justify-content:center;
      text-align:center;
    }

    .card {
      background: linear-gradient(135deg, rgba(20,26,43,0.95), rgba(9,12,24,0.98));
      border-radius: 14px;
      padding: 12px;
      box-shadow: 0 18px 35px rgba(0,0,0,0.8);
      border: 1px solid rgba(59,169,255,0.1);
      backdrop-filter: blur(10px);
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 6px;
    }
    .label {
      font-size: 11px;
      color: var(--muted);
    }
    .class-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 2px;
    }
    .class-meta {
      font-size: 11px;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      gap: 4px;
    }
    .pill {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      color: var(--muted);
      display:flex;
      align-items:baseline;
      gap:10px;
      white-space:nowrap;
    }
    /* 2: æ®‹ã‚Šå›æ•°ã‚’ã§ã‹ã */
    .pill .remain {
      font-size: 16px;
      font-weight: 800;
      color: #e5e7eb;
      letter-spacing: 0.3px;
    }
    .pill .remain small{
      font-size: 11px;
      font-weight: 700;
      color: var(--muted);
    }

    .row {
      display: flex;
      gap: 8px;
      margin-bottom: 6px;
    }
    .row > div { flex: 1; }

    input[type="text"], select, textarea {
      width: 100%;
      padding: 8px 9px;
      border-radius: 10px;
      border: 1px solid #1e293b;
      background: rgba(15,23,42,0.9);
      color: var(--text);
      font-size: 12px; /* è¦‹ãŸç›®ç¶­æŒ */
      outline: none;
    }
    input::placeholder { color: #6b7280; }

    /* iPhoneã®å…¥åŠ›ã‚ºãƒ¼ãƒ å¯¾ç­–ï¼šfocusä¸­ã ã‘16pxï¼ˆviewportç¦æ­¢ã¯ä½¿ã‚ãªã„ï¼‰ */
    input[type="text"]:focus, textarea:focus, select:focus {
      font-size: 16px;
    }

    button {
      width: 100%;
      padding: 8px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(90deg, #22c55e, #06b6d4);
      color: white;
      font-weight: 600;
      font-size: 13px;
      box-shadow: 0 8px 18px rgba(16,185,129,0.55);
      cursor: pointer;
      margin-top: 4px;
    }
    button:active {
      transform: translateY(1px);
      box-shadow: 0 4px 10px rgba(16,185,129,0.45);
    }

    .status-line {
      font-size: 11px;
      color: var(--muted);
      margin-top: 6px;
    }

    /* 10: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡Œæ•´ç† */
    .status-top {
      display:flex;
      justify-content:space-between;
      gap:8px;
      flex-wrap:wrap;
    }
    .status-top span{
      background: rgba(2,6,23,0.35);
      border: 1px solid rgba(148,163,184,0.18);
      padding: 4px 8px;
      border-radius: 999px;
      line-height: 1.2;
    }
    .status-center {
      margin-top: 6px;
      text-align:center;
      font-weight: 900;
      font-size: 16px;
      color: #e5e7eb;
      letter-spacing: .2px;
    }
    .status-center small{
      font-size: 12px;
      font-weight: 700;
      color: var(--muted);
    }

    .progress-bar {
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: #020617;
      overflow: hidden;
      margin-top: 6px;
    }
    .progress-inner {
      height: 100%;
      width: 0%;
      border-radius: inherit;
      background: linear-gradient(90deg, #3ba9ff, #22c55e);
      transition: width 0.25s ease-out;
    }

    .btn-row {
      display: flex;
      gap: 8px;
      margin-top: 4px;
    }
    .btn-row button {
      width: 100%;
      font-size: 12px;
      padding: 7px;
    }
    .btn-quest {
      background: linear-gradient(90deg, #3b82f6, #06b6d4);
      box-shadow: 0 8px 18px rgba(59,130,246,0.55);
    }
    .btn-cash {
      background: linear-gradient(90deg, #f97316, #facc15);
      box-shadow: 0 8px 18px rgba(249,115,22,0.55);
    }

    /* ===== è¿½åŠ ï¼šé…é”æ¸ˆã¿ãƒªã‚¹ãƒˆ ===== */
    .btn-delivered {
      background: linear-gradient(90deg, #64748b, #334155);
      box-shadow: 0 8px 18px rgba(100,116,139,0.35);
    }

    .runlist{
      max-height: 0;
      opacity: 0;
      overflow: hidden;
      margin-top: 0;
      padding: 0 8px;
      border: 1px solid rgba(148,163,184,0.0);
      border-radius: 12px;
      background: rgba(2,6,23,0.20);
      transition: max-height .22s ease, opacity .18s ease, margin-top .18s ease, border-color .18s ease, padding .18s ease, background .18s ease;
      will-change: max-height, opacity;
    }

    /* 9: é–‹ã„ãŸæ™‚ã®èƒŒæ™¯è‰²ã‚’å¤‰ãˆã‚‹ */
    .runlist.open{
      max-height: 1400px;
      opacity: 1;
      margin-top: 8px;
      padding: 10px;
      border-color: rgba(148,163,184,0.22);
      background: rgba(2,6,23,0.55);
    }

    .run-item {
      border: 1px solid rgba(148,163,184,0.18);
      border-radius: 12px;
      padding: 8px;
      margin-bottom: 8px;
      background: rgba(15,23,42,0.65);
    }
    .run-item:last-child { margin-bottom: 0; }
    .run-item .mini {
      font-size: 10px;
      color: var(--muted);
      margin-bottom: 6px;
      display: flex;
      justify-content: space-between;
      gap: 6px;
    }
    .run-item .grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0,1fr));
      gap: 6px;
    }
    .run-item .hint {
      margin-top: 6px;
      font-size: 11px;
      color: #e5e7eb;
      opacity: .9;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .run-item .hint span{
      background: rgba(2,6,23,0.35);
      border: 1px solid rgba(148,163,184,0.16);
      padding: 4px 8px;
      border-radius: 999px;
    }

    .run-item .actions {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }
    .run-item .actions button {
      margin-top: 0;
      padding: 7px;
      font-size: 12px;
    }
    .btn-save {
      background: linear-gradient(90deg, #22c55e, #06b6d4);
    }
    .btn-del {
      background: linear-gradient(90deg, #ef4444, #f97316);
      box-shadow: 0 8px 18px rgba(239,68,68,0.4);
    }

    /* ===== ã‚ªãƒ³ãƒ©ã‚¤ãƒ³/ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ ===== */
    .online-row{
      display:flex;
      gap:8px;
      margin-top:8px;
    }
    .btn-online{
      background: linear-gradient(90deg, #22c55e, #16a34a);
      box-shadow: 0 8px 18px rgba(34,197,94,0.45);
    }
    .btn-offline{
      background: linear-gradient(90deg, #64748b, #334155);
      box-shadow: 0 8px 18px rgba(100,116,139,0.35);
    }
    .online-pill{
      margin-top:6px;
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .online-pill span{
      font-size:11px;
      color:#e5e7eb;
      background: rgba(2,6,23,0.35);
      border: 1px solid rgba(148,163,184,0.18);
      padding: 4px 8px;
      border-radius: 999px;
    }

    /* ===== ç·å£²ä¸Šã®æ®µéšè¡¨ç¤ºï¼ˆCSSã®ã¿ï¼‰ ===== */
    .money-icon{
      font-size: 18px;
      line-height: 1;
      transform: translateY(1px);
    }
    .money-tier-0{ color: #ffffff; text-shadow:none; font-weight:700; }
    .money-tier-1{ color: #ffffff; text-shadow: 0 0 10px rgba(255,255,255,0.15); font-weight:800; }
    .money-tier-2{ color: #fde68a; text-shadow: 0 0 12px rgba(253,230,138,0.25); font-weight:900; }
    .money-tier-3{ color: #facc15; text-shadow: 0 0 14px rgba(250,204,21,0.30); font-weight:900; }
    .money-tier-4{
      font-weight: 1000;
      background: linear-gradient(90deg, #fff3b0, #ffd700, #fff3b0);
      background-size: 200% 100%;
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      animation: shimmer 1.8s linear infinite;
      filter: drop-shadow(0 0 10px rgba(255,215,0,0.25));
    }
    @keyframes shimmer{
      0%{ background-position: 0% 0; }
      100%{ background-position: 200% 0; }
    }

    /* ===== ãƒˆãƒ¼ã‚¹ãƒˆ ===== */
    .toast{
      position: fixed;
      left: 10px;
      right: 10px;
      bottom: 14px;
      z-index: 99998;
      padding: 12px 12px;
      border-radius: 14px;
      background: rgba(0,0,0,0.78);
      border: 1px solid rgba(148,163,184,0.22);
      color: #fff;
      box-shadow: 0 18px 35px rgba(0,0,0,0.65);
      backdrop-filter: blur(10px);
      display:none;
      white-space:pre-wrap;
      font-size: 13px;
      line-height: 1.35;
    }
    .toast strong{ color: #facc15; }

    /* ä»»æ„ï¼šè·é›¢å…¥åŠ›æ¬„ */
    .optional-row{
      display:flex;
      gap:8px;
      margin-top:6px;
      opacity:.95;
    }
    .optional-row .label{
      margin-bottom:4px;
    }
  </style>
</head>

<body>
  <h1>é…é”ãƒ‰ãƒªãƒ«ãƒˆãƒ©ãƒƒã‚«ãƒ¼</h1>
  <div class="sub">ç›®æ¨™ã¯å£²ä¸Šã˜ã‚ƒãªãã€Œãƒ¬ãƒ³ã‚¸å›æ•°ã€ã€‚é‡‘é¡ãƒ»æ™‚é–“ãƒ»ä»¶æ•°ã¯æ¯å›æ‰‹æ‰“ã¡ã§è¨˜éŒ²ã€‚</div>

  <div class="card">
    <div class="dashboard-grid">
      <div class="dash-item">
        <div class="dash-label">ãƒ‰ãƒªãƒ«é€²æ—</div>
        <div class="dash-value"><span id="totalRuns">0</span> / 35å›</div>
      </div>
      <div class="dash-item">
        <div class="dash-label">ç·é…é”ä»¶æ•°</div>
        <div class="dash-value"><span id="totalDeliveries">0</span>ä»¶</div>
      </div>

      <div class="dash-item">
        <div class="dash-label">ã‚¯ã‚¨ã‚¹ãƒˆåˆè¨ˆ</div>
        <div class="dash-value">Â¥<span id="questTotalTop">0</span></div>
      </div>
      <div class="dash-item">
        <div class="dash-label">ç¾é‡‘å›ååˆè¨ˆ</div>
        <div class="dash-value">Â¥<span id="cashTotalTop">0</span></div>
      </div>

      <!-- 5: ã‚ªãƒ³ãƒ©ã‚¤ãƒ³æ™‚çµ¦ï¼ˆç·å£²ä¸Šã®ä¸Šï¼‰ -->
      <div class="dash-total-row" style="background: radial-gradient(circle at top, #22c55e 0, #020617 55%); border-color: rgba(34,197,94,0.55);">
        <div class="dash-label">ã‚ªãƒ³ãƒ©ã‚¤ãƒ³æ™‚çµ¦æ›ç®—ï¼ˆã‚ªãƒ³ãƒ©ã‚¤ãƒ³ä¸­ã®ã¿ï¼‰</div>
        <div class="dash-value">Â¥<span id="onlineHourly">0</span> / h</div>
      </div>

      <div class="dash-total-row">
        <div class="dash-label">ç·å£²ä¸Šï¼ˆã‚¯ã‚¨ã‚¹ãƒˆè¾¼ã¿ãƒ»ç¾é‡‘é™¤å¤–ï¼‰</div>
        <div class="dash-value">
          <span id="moneyIcon" class="money-icon">ğŸª™</span>
          <span id="totalAmount" class="money-tier-0">0</span>
        </div>
      </div>
    </div>

    <!-- 4: ã‚ªãƒ³ãƒ©ã‚¤ãƒ³/ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ -->
    <div class="online-row">
      <button class="btn-online" onclick="setOnline(true)">ã‚ªãƒ³ãƒ©ã‚¤ãƒ³</button>
      <button class="btn-offline" onclick="setOnline(false)">ã‚ªãƒ•ãƒ©ã‚¤ãƒ³</button>
    </div>
    <div class="online-pill">
      <span>çŠ¶æ…‹ï¼š<b id="onlineStateText">OFF</b></span>
      <span>ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ç´¯è¨ˆï¼š<b id="onlineTimeText">0:00</b></span>
    </div>

    <div class="label" style="margin-top:8px;">ãƒ‰ãƒªãƒ«é”æˆåº¦</div>
    <div class="progress-bar">
      <div id="drillProgress" class="progress-inner"></div>
    </div>
  </div>

  <!-- 600å††ãƒ¬ãƒ³ã‚¸ -->
  <div class="card" style="margin-top:10px;">
    <div class="card-header">
      <div>
        <div class="class-title">600å††ãƒ¬ãƒ³ã‚¸</div>
        <div class="class-meta">
          <span>ç›®å®‰: 600å†† / 20åˆ† / ä»¶</span>
          <span>æ®‹ã‚Šæ™‚é–“ã‚’ã“ã®ãƒ¬ãƒ³ã‚¸ã§åŸ‹ã‚ã‚‹</span>
        </div>
      </div>
      <div class="pill">
        <span>é€²æ—: <b id="runs600">0</b>å›</span>
        <span class="remain"><span id="remain600">30</span><small>å› æ®‹ã‚Š</small></span>
      </div>
    </div>

    <div class="row" style="margin-top:6px;">
      <div>
        <div class="label">é‡‘é¡ (å††)</div>
        <input type="text" inputmode="numeric" pattern="[0-9]*" id="inputAmount600" placeholder="ä¾‹: 620" />
      </div>
      <div>
        <div class="label">æ™‚é–“ (åˆ†)</div>
        <input type="text" inputmode="numeric" pattern="[0-9]*" id="inputTime600" placeholder="ä¾‹: 20" />
      </div>
      <div>
        <div class="label">ç¾é‡‘å›å (å††)</div>
        <input type="text" inputmode="numeric" pattern="[0-9]*" id="inputCash600" placeholder="ä¾‹: 100" />
      </div>
      <div>
        <div class="label">ä»¶æ•° (ä»¶)</div>
        <select id="inputCount600">
          <option value="1" selected>1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </div>
    </div>

    <!-- 11: è·é›¢ï¼ˆä»»æ„ï¼‰ -->
    <div class="optional-row">
      <div style="flex:1;">
        <div class="label">èµ°è¡Œè·é›¢ (km) â€»ä»»æ„</div>
        <input type="text" inputmode="decimal" id="inputDist600" placeholder="ä¾‹: 3.2" />
      </div>
    </div>

    <div class="btn-row" style="margin-top:6px;">
      <button class="btn-delivered" onclick="toggleRunList('600')">é…é”æ¸ˆã¿</button>
      <button onclick="addClassRun('600')">è¿½åŠ </button>
    </div>
    <div id="runList600" class="runlist"></div>

    <div class="status-line">
      <div class="status-top">
        <span>Â¥ <b id="amount600">0</b></span>
        <span><b id="time600">0</b> åˆ†</span>
        <span>ç›®æ¨™å›æ•°ï¼š<b>30</b>å›</span>
        <span>æ¨å¥¨(ç›®å®‰)ï¼š<b id="suggest600" style="color:var(--gold);">0</b>å›</span>
        <span>å¹³å‡æ™‚çµ¦ï¼šÂ¥<b id="avgHourly600">0</b>/h</span>
        <span>åˆ†å˜ä¾¡ï¼šÂ¥<b id="avgPerMin600">0</b>/åˆ†</span>
      </div>
      <div class="status-center">
        é…é”å›æ•°ï¼š<span id="doneRuns600">0</span> / 30 <small>ï¼ˆå®Ÿé…é”ä»¶æ•°ï¼š<span id="delivered600">0</span>ä»¶ï¼‰</small>
      </div>
    </div>
    <div class="progress-bar">
      <div id="progress600" class="progress-inner"></div>
    </div>
  </div>

  <!-- 1000å††ãƒ¬ãƒ³ã‚¸ -->
  <div class="card" style="margin-top:10px;">
    <div class="card-header">
      <div>
        <div class="class-title">1000å††ãƒ¬ãƒ³ã‚¸</div>
        <div class="class-meta">
          <span>ç›®å®‰: 1000å†† / 30åˆ† / ä»¶</span>
          <span>ç›®æ¨™ 6å›ï¼ˆãƒ¬ãƒ³ã‚¸ãƒ‰ãƒªãƒ«ï¼‰</span>
        </div>
      </div>
      <div class="pill">
        <span>é€²æ—: <b id="runs1000">0</b>å›</span>
        <span class="remain"><span id="remain1000">6</span><small>å› æ®‹ã‚Š</small></span>
      </div>
    </div>

    <div class="row" style="margin-top:6px;">
      <div>
        <div class="label">é‡‘é¡ (å††)</div>
        <input type="text" inputmode="numeric" pattern="[0-9]*" id="inputAmount1000" placeholder="ä¾‹: 1050" />
      </div>
      <div>
        <div class="label">æ™‚é–“ (åˆ†)</div>
        <input type="text" inputmode="numeric" pattern="[0-9]*" id="inputTime1000" placeholder="ä¾‹: 30" />
      </div>
      <div>
        <div class="label">ç¾é‡‘å›å (å††)</div>
        <input type="text" inputmode="numeric" pattern="[0-9]*" id="inputCash1000" placeholder="ä¾‹: 150" />
      </div>
      <div>
        <div class="label">ä»¶æ•° (ä»¶)</div>
        <select id="inputCount1000">
          <option value="1">1</option>
          <option value="2" selected>2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </div>
    </div>

    <div class="optional-row">
      <div style="flex:1;">
        <div class="label">èµ°è¡Œè·é›¢ (km) â€»ä»»æ„</div>
        <input type="text" inputmode="decimal" id="inputDist1000" placeholder="ä¾‹: 4.7" />
      </div>
    </div>

    <div class="btn-row" style="margin-top:6px;">
      <button class="btn-delivered" onclick="toggleRunList('1000')">é…é”æ¸ˆã¿</button>
      <button onclick="addClassRun('1000')">è¿½åŠ </button>
    </div>
    <div id="runList1000" class="runlist"></div>

    <div class="status-line">
      <div class="status-top">
        <span>Â¥ <b id="amount1000">0</b></span>
        <span><b id="time1000">0</b> åˆ†</span>
        <span>ç›®æ¨™å›æ•°ï¼š<b>6</b>å›</span>
        <span>å¹³å‡æ™‚çµ¦ï¼šÂ¥<b id="avgHourly1000">0</b>/h</span>
        <span>åˆ†å˜ä¾¡ï¼šÂ¥<b id="avgPerMin1000">0</b>/åˆ†</span>
      </div>
      <div class="status-center">
        é…é”å›æ•°ï¼š<span id="doneRuns1000">0</span> / 6 <small>ï¼ˆå®Ÿé…é”ä»¶æ•°ï¼š<span id="delivered1000">0</span>ä»¶ï¼‰</small>
      </div>
    </div>
    <div class="progress-bar">
      <div id="progress1000" class="progress-inner"></div>
    </div>
  </div>

  <!-- 1500å††ãƒ¬ãƒ³ã‚¸ -->
  <div class="card" style="margin-top:10px;">
    <div class="card-header">
      <div>
        <div class="class-title">1500å††ãƒ¬ãƒ³ã‚¸</div>
        <div class="class-meta">
          <span>ç›®å®‰: 1500å†† / 40åˆ† / ä»¶</span>
          <span>ç›®æ¨™ 2å›ï¼ˆãƒ¬ãƒ³ã‚¸ãƒ‰ãƒªãƒ«ï¼‰</span>
        </div>
      </div>
      <div class="pill">
        <span>é€²æ—: <b id="runs1500">0</b>å›</span>
        <span class="remain"><span id="remain1500">2</span><small>å› æ®‹ã‚Š</small></span>
      </div>
    </div>

    <div class="row" style="margin-top:6px;">
      <div>
        <div class="label">é‡‘é¡ (å††)</div>
        <input type="text" inputmode="numeric" pattern="[0-9]*" id="inputAmount1500" placeholder="ä¾‹: 1640" />
      </div>
      <div>
        <div class="label">æ™‚é–“ (åˆ†)</div>
        <input type="text" inputmode="numeric" pattern="[0-9]*" id="inputTime1500" placeholder="ä¾‹: 40" />
      </div>
      <div>
        <div class="label">ç¾é‡‘å›å (å††)</div>
        <input type="text" inputmode="numeric" pattern="[0-9]*" id="inputCash1500" placeholder="ä¾‹: 200" />
      </div>
      <div>
        <div class="label">ä»¶æ•° (ä»¶)</div>
        <select id="inputCount1500">
          <option value="1">1</option>
          <option value="2" selected>2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </div>
    </div>

    <div class="optional-row">
      <div style="flex:1;">
        <div class="label">èµ°è¡Œè·é›¢ (km) â€»ä»»æ„</div>
        <input type="text" inputmode="decimal" id="inputDist1500" placeholder="ä¾‹: 6.1" />
      </div>
    </div>

    <div class="btn-row" style="margin-top:6px;">
      <button class="btn-delivered" onclick="toggleRunList('1500')">é…é”æ¸ˆã¿</button>
      <button onclick="addClassRun('1500')">è¿½åŠ </button>
    </div>
    <div id="runList1500" class="runlist"></div>

    <div class="status-line">
      <div class="status-top">
        <span>Â¥ <b id="amount1500">0</b></span>
        <span><b id="time1500">0</b> åˆ†</span>
        <span>ç›®æ¨™å›æ•°ï¼š<b>2</b>å›</span>
        <span>å¹³å‡æ™‚çµ¦ï¼šÂ¥<b id="avgHourly1500">0</b>/h</span>
        <span>åˆ†å˜ä¾¡ï¼šÂ¥<b id="avgPerMin1500">0</b>/åˆ†</span>
      </div>
      <div class="status-center">
        é…é”å›æ•°ï¼š<span id="doneRuns1500">0</span> / 2 <small>ï¼ˆå®Ÿé…é”ä»¶æ•°ï¼š<span id="delivered1500">0</span>ä»¶ï¼‰</small>
      </div>
    </div>
    <div class="progress-bar">
      <div id="progress1500" class="progress-inner"></div>
    </div>
  </div>

  <!-- ã‚«ã‚¹ã‚¿ãƒ  -->
  <div class="card" style="margin-top:10px;">
    <div class="card-header">
      <div>
        <div class="class-title">ã‚«ã‚¹ã‚¿ãƒ </div>
        <div class="class-meta">
          <span>é‡‘é¡ & æ™‚é–“ãŒç‰¹æ®Šãªæ¡ˆä»¶ç”¨</span>
        </div>
      </div>
      <div class="pill">å›æ•°: <b id="runsCustom">0</b>å›</div>
    </div>
    <div class="row" style="margin-top:6px;">
      <div>
        <div class="label">é‡‘é¡ (å††)</div>
        <input type="text" inputmode="numeric" pattern="[0-9]*" id="inputCustomAmount" placeholder="ä¾‹: 2500" />
      </div>
      <div>
        <div class="label">æ™‚é–“ (åˆ†)</div>
        <input type="text" inputmode="numeric" pattern="[0-9]*" id="inputCustomTime" placeholder="ä¾‹: 45" />
      </div>
      <div>
        <div class="label">ç¾é‡‘å›å (å††)</div>
        <input type="text" inputmode="numeric" pattern="[0-9]*" id="inputCustomCash" placeholder="ä¾‹: 300" />
      </div>
      <div>
        <div class="label">ä»¶æ•° (ä»¶)</div>
        <select id="inputCustomCount">
          <option value="1" selected>1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </div>
    </div>

    <div class="optional-row">
      <div style="flex:1;">
        <div class="label">èµ°è¡Œè·é›¢ (km) â€»ä»»æ„</div>
        <input type="text" inputmode="decimal" id="inputDistcustom" placeholder="ä¾‹: 8.9" />
      </div>
    </div>

    <div class="btn-row" style="margin-top:6px;">
      <button class="btn-delivered" onclick="toggleRunList('custom')">é…é”æ¸ˆã¿</button>
      <button onclick="addCustom()">è¿½åŠ </button>
    </div>
    <div id="runListcustom" class="runlist"></div>

    <div class="status-line">
      <div class="status-top">
        <span>Â¥ <b id="amountCustom">0</b></span>
        <span><b id="timeCustom">0</b> åˆ†</span>
        <span>å¹³å‡å˜ä¾¡ï¼šÂ¥<b id="avgCustom">0</b></span>
        <span>å¹³å‡æ™‚çµ¦ï¼šÂ¥<b id="avgHourlyCustom">0</b>/h</span>
        <span>åˆ†å˜ä¾¡ï¼šÂ¥<b id="avgPerMinCustom">0</b>/åˆ†</span>
      </div>
      <div class="status-center">
        é…é”å›æ•°ï¼š<span id="doneRunsCustom">0</span> <small>ï¼ˆå®Ÿé…é”ä»¶æ•°ï¼š<span id="deliveredCustom">0</span>ä»¶ï¼‰</small>
      </div>
    </div>
  </div>

  <!-- ã‚¯ã‚¨ã‚¹ãƒˆ & ä»Šæ—¥ã®ãƒ¡ãƒ¢ & ç¾é‡‘å›å -->
  <div class="card" style="margin-top:10px; margin-bottom:10px;">
    <div class="class-title">ã‚¯ã‚¨ã‚¹ãƒˆ & ä»Šæ—¥ã®ãƒ¡ãƒ¢ & ç¾é‡‘å›å</div>
    <div class="row" style="margin-top:6px;">
      <div>
        <div class="label">ã‚¯ã‚¨ã‚¹ãƒˆé‡‘é¡ (å††)</div>
        <input type="text" inputmode="numeric" pattern="[0-9]*" id="inputQuest" placeholder="ä¾‹: 1200" />
      </div>
      <div>
        <div class="label">ç¾é‡‘å›å (å††)</div>
        <input type="text" inputmode="numeric" pattern="[0-9]*" id="inputCash" placeholder="ä¾‹: 500" />
      </div>
    </div>
    <div class="btn-row">
      <button class="btn-quest" onclick="addQuest()">ã‚¯ã‚¨ã‚¹ãƒˆã‚’è¿½åŠ </button>
      <button class="btn-cash" onclick="addCash()">ç¾é‡‘å›åã‚’è¿½åŠ </button>
    </div>
    <div class="status-line" style="display:flex; gap:8px; flex-wrap:wrap;">
      <span style="background: rgba(2,6,23,0.35); border: 1px solid rgba(148,163,184,0.18); padding: 4px 8px; border-radius:999px;">ã‚¯ã‚¨ã‚¹ãƒˆåˆè¨ˆ: Â¥<b id="questOnly">0</b></span>
      <span style="background: rgba(2,6,23,0.35); border: 1px solid rgba(148,163,184,0.18); padding: 4px 8px; border-radius:999px;">ç¾é‡‘å›ååˆè¨ˆ: Â¥<b id="cashOnly">0</b></span>
    </div>
    <div class="label" style="margin-top:6px;">ä»Šæ—¥ã®ãƒ¡ãƒ¢ï¼ˆé›¨ / ä¼‘æ—¥ / ãƒ–ãƒ¼ã‚¹ãƒˆ ãªã©ï¼‰</div>
    <textarea id="dailyNote" placeholder="ä¾‹: é›¨ã‚¯ã‚¨ä¸­ / å¤•æ–¹ã‹ã‚‰ãƒ–ãƒ¼ã‚¹ãƒˆå¼·ã‚ ãªã©"></textarea>
  </div>

  <!-- ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ -->
  <div class="card" style="margin-top:8px; margin-bottom:8px; text-align:center;">
    <div class="label" style="margin-bottom:4px;">ä»Šæ—¥ã®è¨˜éŒ²ã‚’å…¨éƒ¨ãƒªã‚»ãƒƒãƒˆ</div>
    <button onclick="resetAll()" style="max-width:260px; margin:0 auto; background:linear-gradient(90deg,#ef4444,#f97316);">
      å…¨ãƒªã‚»ãƒƒãƒˆï¼ˆä»¶æ•°ãƒ»é‡‘é¡ãƒ»ãƒ¡ãƒ¢ï¼‰
    </button>
  </div>

  <!-- æ›´æ–°ãƒœã‚¿ãƒ³ -->
  <div class="card" style="margin-top:8px; margin-bottom:24px; text-align:center;">
    <div class="label" style="margin-bottom:4px;">ã‚³ãƒ¼ãƒ‰æ›´æ–°å¾Œã«æŠ¼ã™ç”¨</div>
    <button onclick="location.reload()" style="max-width:260px; margin:0 auto;">
      ãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ï¼ˆæœ€æ–°ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿è¾¼ã‚€ï¼‰
    </button>
  </div>

  <!-- 12: è¿½åŠ å¾Œãƒˆãƒ¼ã‚¹ãƒˆ -->
  <div id="toast" class="toast"></div>

  <script>
  // ===== DEBUGï¼ˆä»Šã¯æ®‹ã™ãªã‚‰æ®‹ã—ã¦OKï¼šãŸã ã—å°†æ¥æ¶ˆã™ç”¨ã«ä¸€å¡Šï¼‰=====
(() => {
  const box = document.createElement("pre");
  box.id = "debugBox";
  box.style.cssText = [
    "position:fixed",
    "left:8px",
    "right:8px",
    "bottom:90px",
    "max-height:30vh",
    "overflow:auto",
    "padding:10px",
    "border-radius:12px",
    "background:rgba(0,0,0,0.70)",
    "color:#fff",
    "font-size:12px",
    "z-index:99997",
    "white-space:pre-wrap",
    "display:none" /* â†æ™®æ®µã¯éš ã™ï¼šã‚¨ãƒ©ãƒ¼æ™‚ã ã‘å‡ºã™ */
  ].join(";");
  box.textContent = "debug: script start\n";
  document.addEventListener("DOMContentLoaded", () => document.body.appendChild(box));

  const show = () => { box.style.display = "block"; };
  const log = (msg) => { show(); box.textContent += msg + "\n"; };

  window.onerror = (m, src, line, col) => {
    log("âŒ window.onerror");
    log(String(m));
    log(`${src || ""}  ${line}:${col}`);
  };

  window.addEventListener("unhandledrejection", (e) => {
    log("âŒ unhandledrejection");
    log(String(e.reason));
  });

  // å‹•ã„ã¦ã‚‹ã‹ç¢ºèªç”¨ï¼ˆå¿…è¦ãªã‚‰ __ping()ï¼‰
  window.__ping = () => log("âœ… ping " + new Date().toLocaleTimeString());
})();
  // =====================================================

    const STATE_KEY = "deliveryDrillState_v10_range_online_toast";
    const LEGACY_KEYS = ["deliveryDrillState_v9_store_core", "deliveryDrillState_v8"];

    const TARGETS = { "600": 30, "1000": 6, "1500": 2 };

    // =========================
    // coreï¼ˆDOMä¾å­˜ãªã—ï¼‰
    // =========================
    const core = (() => {
      const num = (v) => {
        const s = (v ?? "").toString().replace(/[^\d-]/g, "");
        const n = parseInt(s || "0", 10);
        return Number.isFinite(n) ? n : 0;
      };

      const fnum = (v) => {
        const s = (v ?? "").toString().replace(/[^\d.-]/g, "");
        const n = parseFloat(s || "0");
        return Number.isFinite(n) ? n : 0;
      };

      const uid = () => "r_" + Date.now().toString(36) + "_" + Math.random().toString(36).slice(2, 8);

      const toDateStr = (ts) => {
        const d = new Date(ts || Date.now());
        const y = d.getFullYear();
        const m = String(d.getMonth()+1).padStart(2,"0");
        const day = String(d.getDate()).padStart(2,"0");
        return `${y}-${m}-${day}`;
      };

      const safeJsonParse = (s, fallback) => {
        try { return JSON.parse(s); } catch(e) { return fallback; }
      };

      const packMemo = (obj) => JSON.stringify(obj || {});
      const unpackMemo = (memo) => {
        if (!memo) return {};
        if (typeof memo === "string") return safeJsonParse(memo, {});
        if (typeof memo === "object") return memo;
        return {};
      };

      const migrateRunsLogEntry = (r) => {
        const isNew = r && typeof r === "object"
          && ("id" in r) && ("date" in r) && ("minutes" in r) && ("amount" in r) && ("memo" in r);

        if (isNew) return {
          id: String(r.id || uid()),
          date: String(r.date || toDateStr(Date.now())),
          minutes: num(r.minutes),
          amount: num(r.amount),
          memo: typeof r.memo === "string" ? r.memo : packMemo(r.memo)
        };

        const ts = (r && typeof r.ts === "number") ? r.ts : Date.now();
        const key = r?.key ?? r?.classKey ?? "";
        const time = num(r?.time ?? r?.minutes);
        const cash = num(r?.cash);
        const count = num(r?.count);
        const dist = (r?.dist != null) ? r.dist : 0;

        const memoObj = Object.assign(
          {},
          (r && r.memo ? unpackMemo(r.memo) : {}),
          { key, time, cash, count, ts, dist }
        );

        return {
          id: String(r?.id || uid()),
          date: toDateStr(ts),
          minutes: time,
          amount: num(r?.amount),
          memo: packMemo(memoObj)
        };
      };

      const toUiRun = (r) => {
        const memo = unpackMemo(r?.memo);
        const ts = (typeof memo.ts === "number") ? memo.ts : Date.now();
        return {
          id: String(r?.id || uid()),
          key: memo.key || "custom",
          amount: num(r?.amount),
          time: num(r?.minutes ?? memo.time),
          cash: num(memo.cash),
          count: num(memo.count) || 0,
          dist: (memo.dist != null) ? memo.dist : 0,
          ts
        };
      };

      const aggregateFromUiRuns = (uiRuns) => {
        const agg = {
          runs:      { "1500": 0, "1000": 0, "600": 0, custom: 0 },
          delivered: { "1500": 0, "1000": 0, "600": 0, custom: 0 },
          amounts:   { "1500": 0, "1000": 0, "600": 0, custom: 0 },
          times:     { "1500": 0, "1000": 0, "600": 0, custom: 0 }
        };

        for (const r of uiRuns) {
          const k = r.key;
          if (!(k in agg.runs)) continue;
          agg.runs[k] += 1;
          agg.delivered[k] += (r.count || 0);
          agg.amounts[k] += (r.amount || 0);
          agg.times[k] += (r.time || 0);
        }
        return agg;
      };

      const getCashFromNewEntry = (entry) => num(unpackMemo(entry?.memo)?.cash);
      const getKeyFromNewEntry  = (entry) => unpackMemo(entry?.memo)?.key || "custom";
      const getTsFromNewEntry   = (entry) => (typeof unpackMemo(entry?.memo)?.ts === "number") ? unpackMemo(entry?.memo).ts : Date.now();

      const updateNewEntryMemo = (entry, patch) => {
        const memo = unpackMemo(entry?.memo);
        const next = Object.assign({}, memo, patch);
        return Object.assign({}, entry, { memo: packMemo(next) });
      };

      const perMin = (amount, minutes) => {
        const m = Math.max(1, num(minutes));
        return Math.round((num(amount) / m) * 10) / 10;
      };

      const hourly = (amount, minutes) => {
        const m = Math.max(1, num(minutes));
        return Math.round((num(amount) / m) * 60);
      };

      return {
        num, fnum, uid, toDateStr,
        migrateRunsLogEntry, toUiRun, aggregateFromUiRuns,
        getCashFromNewEntry, getKeyFromNewEntry, getTsFromNewEntry,
        updateNewEntryMemo, packMemo, unpackMemo,
        perMin, hourly
      };
    })();

    // =========================
    // storeï¼ˆlocalStorageç›´æ›¸ãç¦æ­¢ï¼‰
    // =========================
    const store = (() => {
      const baseState = {
        runsLog: [],
        quest: 0,
        cash: 0,
        note: "",
        online: { isOnline:false, startedAt:0, totalMs:0 }
      };

      const tryLoad = (key) => {
        try {
          const raw = localStorage.getItem(key);
          if (!raw) return null;
          const parsed = JSON.parse(raw);
          const s = Object.assign({}, baseState, parsed);

          const list = Array.isArray(s.runsLog) ? s.runsLog : [];
          s.runsLog = list.map(core.migrateRunsLogEntry);

          s.quest = core.num(s.quest);
          s.cash  = core.num(s.cash);
          s.note  = (s.note ?? "").toString();

          const o = s.online || {};
          s.online = {
            isOnline: !!o.isOnline,
            startedAt: core.num(o.startedAt),
            totalMs: core.num(o.totalMs)
          };

          return s;
        } catch (e) {
          return null;
        }
      };

      const load = () => {
        let s = tryLoad(STATE_KEY);
        if (!s) {
          for (const k of (LEGACY_KEYS || [])) {
            s = tryLoad(k);
            if (s) break;
          }
        }
        return s || Object.assign({}, baseState);
      };

      const save = (state) => {
        const s = Object.assign({}, baseState, state);

        const list = Array.isArray(s.runsLog) ? s.runsLog : [];
        s.runsLog = list.map(core.migrateRunsLogEntry);

        s.quest = core.num(s.quest);
        s.cash  = core.num(s.cash);
        s.note  = (s.note ?? "").toString();

        const o = s.online || {};
        s.online = {
          isOnline: !!o.isOnline,
          startedAt: core.num(o.startedAt),
          totalMs: core.num(o.totalMs)
        };

        try {
          localStorage.setItem(STATE_KEY, JSON.stringify(s));
        } catch(e) {}
      };

      return { load, save };
    })();

    // =========================
    // stateï¼ˆã‚¢ãƒ—ãƒªã®å”¯ä¸€ã®çŠ¶æ…‹ï¼‰
    // =========================
    let state = store.load();
    const el = (id) => document.getElementById(id);

    // =========================
    // toast
    // =========================
    let toastTimer = null;
    function showToast(text){
      const box = el("toast");
      if (!box) return;
      box.textContent = text;
      box.style.display = "block";
      if (toastTimer) clearTimeout(toastTimer);
      toastTimer = setTimeout(() => {
        box.style.display = "none";
      }, 5000);
    }

    // =========================
    // ã‚ªãƒ³ãƒ©ã‚¤ãƒ³åˆ¶å¾¡
    // =========================
    function setOnline(on){
      const now = Date.now();
      if (on) {
        if (!state.online.isOnline) {
          state.online.isOnline = true;
          state.online.startedAt = now;
          store.save(state);
        }
      } else {
        if (state.online.isOnline) {
          const add = Math.max(0, now - (state.online.startedAt || now));
          state.online.totalMs += add;
          state.online.isOnline = false;
          state.online.startedAt = 0;
          store.save(state);
        }
      }
      calcTotals();
    }

    function getOnlineMs(){
      const now = Date.now();
      const base = core.num(state.online.totalMs);
      if (state.online.isOnline && state.online.startedAt) {
        return base + Math.max(0, now - state.online.startedAt);
      }
      return base;
    }

    function fmtMin(ms){
      const totalMin = Math.floor(ms / 60000);
      const h = Math.floor(totalMin / 60);
      const m = totalMin % 60;
      return `${h}:${String(m).padStart(2,"0")}`;
    }

    // =========================
    // ç·å£²ä¸Šï¼šæ®µéšè¡¨ç¾
    // =========================
    function applyMoneyTier(total){
      const amt = core.num(total);
      const span = el("totalAmount");
      const icon = el("moneyIcon");
      if (!span || !icon) return;

      span.classList.remove("money-tier-0","money-tier-1","money-tier-2","money-tier-3","money-tier-4");

      // tiers:
      // 0ã€œ5000
      // 5000ã€œ10000
      // 10000ã€œ15000
      // 15000ã€œ23000
      // 23000ã€œ
      if (amt < 5000) {
        span.classList.add("money-tier-0");
        icon.textContent = "ğŸª™";
      } else if (amt < 10000) {
        span.classList.add("money-tier-1");
        icon.textContent = "ğŸ‘›";
      } else if (amt < 15000) {
        span.classList.add("money-tier-2");
        icon.textContent = "ğŸª™ğŸª™";
      } else if (amt < 23000) {
        span.classList.add("money-tier-3");
        icon.textContent = "ğŸ’°";
      } else {
        span.classList.add("money-tier-4");
        icon.textContent = "ğŸ’°âœ¨";
      }
    }

    // =========================
    // UIæ›´æ–°
    // =========================
    function calcTotals() {
      const uiRuns = state.runsLog.map(core.toUiRun);
      const a = core.aggregateFromUiRuns(uiRuns);

      const totalRuns = a.runs["1500"] + a.runs["1000"] + a.runs["600"] + a.runs.custom;
      const totalDeliveries = a.delivered["1500"] + a.delivered["1000"] + a.delivered["600"] + a.delivered.custom;

      const totalClassAmount = a.amounts["1500"] + a.amounts["1000"] + a.amounts["600"] + a.amounts.custom;
      const totalAmount = totalClassAmount + (state.quest || 0);

      el("totalRuns").textContent = totalRuns.toString();
      el("totalDeliveries").textContent = totalDeliveries.toString();
      el("totalAmount").textContent = totalAmount.toLocaleString();
      applyMoneyTier(totalAmount);

      el("questTotalTop").textContent = (state.quest || 0).toLocaleString();
      el("cashTotalTop").textContent  = (state.cash  || 0).toLocaleString();

      const drillPercent = Math.min(100, (totalRuns / 35) * 100);
      el("drillProgress").style.width = drillPercent + "%";

      el("runs1500").textContent = a.runs["1500"].toString();
      el("runs1000").textContent = a.runs["1000"].toString();
      el("runs600").textContent  = a.runs["600"].toString();
      el("runsCustom").textContent = a.runs.custom.toString();

      el("doneRuns1500").textContent = a.runs["1500"].toString();
      el("doneRuns1000").textContent = a.runs["1000"].toString();
      el("doneRuns600").textContent  = a.runs["600"].toString();
      el("doneRunsCustom").textContent = a.runs.custom.toString();

      ["1500","1000","600"].forEach(k => {
        el("delivered" + k).textContent = a.delivered[k].toString();
        el("amount" + k).textContent = a.amounts[k].toLocaleString();
        el("time" + k).textContent = a.times[k].toString();
      });

      el("deliveredCustom").textContent = a.delivered.custom.toString();
      el("amountCustom").textContent    = a.amounts.custom.toLocaleString();
      el("timeCustom").textContent      = a.times.custom.toString();

      const p1500 = Math.min(100, (a.runs["1500"] / 2) * 100);
      const p1000 = Math.min(100, (a.runs["1000"] / 6) * 100);
      const p600  = Math.min(100, (a.runs["600"]  / 30) * 100);
      el("progress1500").style.width = p1500 + "%";
      el("progress1000").style.width = p1000 + "%";
      el("progress600").style.width  = p600 + "%";

      // æ®‹ã‚Šå›æ•°ï¼ˆ2ï¼‰
      el("remain600").textContent  = String(Math.max(0, TARGETS["600"] - a.runs["600"]));
      el("remain1000").textContent = String(Math.max(0, TARGETS["1000"] - a.runs["1000"]));
      el("remain1500").textContent = String(Math.max(0, TARGETS["1500"] - a.runs["1500"]));

      // æ¨å¥¨å›æ•°ï¼ˆ600ï¼‰
      const usedTime = a.times["1500"] + a.times["1000"] + a.times["600"] + a.times.custom;
      const targetTime = 750; // 12.5æ™‚é–“
      const remain = Math.max(0, targetTime - usedTime);
      const suggest = Math.floor(remain / 20);
      el("suggest600").textContent = suggest.toString();

      // å¹³å‡å˜ä¾¡ï¼ˆcustomï¼‰
      const avg = a.delivered.custom ? Math.round(a.amounts.custom / a.delivered.custom) : 0;
      el("avgCustom").textContent = avg.toLocaleString();

      // å¹³å‡æ™‚çµ¦/åˆ†å˜ä¾¡ï¼ˆå„ãƒ¬ãƒ³ã‚¸ï¼‰
      function setRates(k){
        const amount = a.amounts[k];
        const time = a.times[k];
        const h = time > 0 ? core.hourly(amount, time) : 0;
        const pm = time > 0 ? core.perMin(amount, time) : 0;

        const idH = (k==="custom") ? "avgHourlyCustom" : ("avgHourly" + k);
        const idP = (k==="custom") ? "avgPerMinCustom" : ("avgPerMin" + k);

        const eh = document.getElementById(idH);
        const ep = document.getElementById(idP);
        if (eh) eh.textContent = h.toLocaleString();
        if (ep) ep.textContent = pm.toLocaleString();
      }
      ["600","1000","1500","custom"].forEach(setRates);

      el("questOnly").textContent = (state.quest || 0).toLocaleString();
      el("cashOnly").textContent  = (state.cash  || 0).toLocaleString();
      el("dailyNote").value       = state.note || "";

      // ã‚ªãƒ³ãƒ©ã‚¤ãƒ³è¡¨ç¤º
      const ms = getOnlineMs();
      el("onlineTimeText").textContent = fmtMin(ms);
      el("onlineStateText").textContent = state.online.isOnline ? "ON" : "OFF";

      const onlineMin = Math.max(0, Math.floor(ms / 60000));
      const onlineHourly = (state.online.isOnline && onlineMin > 0) ? Math.round((totalAmount / onlineMin) * 60) : 0;
      el("onlineHourly").textContent = onlineHourly.toLocaleString();

      ["600","1000","1500","custom"].forEach(renderRunListIfOpen);
    }

    // =========================
    // è¿½åŠ ï¼ˆrunsLogã¯æ–°å‹ã§ä¿å­˜ï¼‰
    // =========================
    function addClassRun(key) {
      const amount = core.num(el("inputAmount" + key).value);
      const time   = core.num(el("inputTime" + key).value);
      const cash   = core.num(el("inputCash" + key).value);
      const count  = core.num(el("inputCount" + key).value);
      const dist   = core.fnum(el("inputDist" + key).value);

      if (count <= 0) return;
      if (amount <= 0) return;

      const ts = Date.now();
      const entry = {
        id: core.uid(),
        date: core.toDateStr(ts),
        minutes: time,
        amount: amount,
        memo: core.packMemo({ key, cash, count, ts, time, dist })
      };

      state.runsLog.push(entry);
      if (cash > 0) state.cash += cash;

      el("inputAmount" + key).value = "";
      el("inputTime" + key).value   = "";
      el("inputCash" + key).value   = "";
      el("inputDist" + key).value   = "";

      store.save(state);
      calcTotals();

      // 12: ãŠã¤ã‹ã‚Œãƒˆãƒ¼ã‚¹ãƒˆï¼ˆ3: è¿½åŠ æ™‚ã«æ™‚çµ¦/åˆ†å˜ä¾¡ï¼‰
      const h = (time > 0) ? core.hourly(amount, time) : 0;
      const pm = (time > 0) ? core.perMin(amount, time) : 0;
      const target = TARGETS[key] || 0;
      const nowRuns = core.num(el("runs" + key).textContent);
      const remainRuns = target ? Math.max(0, target - nowRuns) : 0;

      showToast(
        `ãŠã¤ã‹ã‚Œï¼\n` +
        `æ™‚çµ¦æ›ç®—ï¼šÂ¥${h.toLocaleString()}/hã€€åˆ†å˜ä¾¡ï¼šÂ¥${pm.toLocaleString()}/åˆ†\n` +
        (target ? `ã“ã®ãƒ¬ãƒ³ã‚¸æ®‹ã‚Šï¼š${remainRuns}å›` : `ã‚«ã‚¹ã‚¿ãƒ è¿½åŠ OK`)
      );
    }

    function addCustom() {
      const amount = core.num(el("inputCustomAmount").value);
      const time   = core.num(el("inputCustomTime").value);
      const cash   = core.num(el("inputCustomCash").value);
      const count  = core.num(el("inputCustomCount").value);
      const dist   = core.fnum(el("inputDistcustom").value);

      if (count <= 0) return;
      if (amount <= 0) return;

      const ts = Date.now();
      const entry = {
        id: core.uid(),
        date: core.toDateStr(ts),
        minutes: time,
        amount: amount,
        memo: core.packMemo({ key: "custom", cash, count, ts, time, dist })
      };

      state.runsLog.push(entry);
      if (cash > 0) state.cash += cash;

      el("inputCustomAmount").value = "";
      el("inputCustomTime").value   = "";
      el("inputCustomCash").value   = "";
      el("inputDistcustom").value   = "";

      store.save(state);
      calcTotals();

      const h = (time > 0) ? core.hourly(amount, time) : 0;
      const pm = (time > 0) ? core.perMin(amount, time) : 0;
      showToast(`ãŠã¤ã‹ã‚Œï¼\næ™‚çµ¦æ›ç®—ï¼šÂ¥${h.toLocaleString()}/hã€€åˆ†å˜ä¾¡ï¼šÂ¥${pm.toLocaleString()}/åˆ†`);
    }

    function addQuest() {
      const q = core.num(el("inputQuest").value);
      if (q <= 0) return;
      state.quest += q;
      el("inputQuest").value = "";
      store.save(state);
      calcTotals();
    }

    function addCash() {
      const c = core.num(el("inputCash").value);
      if (c <= 0) return;
      state.cash += c;
      el("inputCash").value = "";
      store.save(state);
      calcTotals();
    }

    function resetAll() {
      if (!confirm("æœ¬å½“ã«ä»Šæ—¥ã®è¨˜éŒ²ã‚’å…¨éƒ¨ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")) return;
      state = { runsLog: [], quest: 0, cash: 0, note: "", online: { isOnline:false, startedAt:0, totalMs:0 } };
      store.save(state);
      calcTotals();
    }

    // =========================
    // é…é”æ¸ˆã¿ãƒªã‚¹ãƒˆ
    // =========================
    function toggleRunList(key) {
      const box = el("runList" + key);
      if (!box) return;

      const willOpen = !box.classList.contains("open");
      box.classList.toggle("open");

      if (willOpen) renderRunList(key);
    }

    function renderRunListIfOpen(key) {
      const box = el("runList" + key);
      if (!box) return;
      if (box.classList.contains("open")) renderRunList(key);
    }

    const MAX_RENDER_PER_CLASS = 300;

    function renderRunList(key) {
      const box = el("runList" + key);
      if (!box) return;

      const uiRuns = state.runsLog.map(core.toUiRun);

      const list = uiRuns
        .filter(r => r.key === key)
        .sort((a,b) => (b.ts || 0) - (a.ts || 0))
        .slice(0, MAX_RENDER_PER_CLASS);

      if (list.length === 0) {
        box.innerHTML = `<div class="label">ã¾ã ã“ã®ãƒ¬ãƒ³ã‚¸ã®é…é”è¨˜éŒ²ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</div>`;
        return;
      }

      box.innerHTML = list.map(r => {
        const d = new Date(r.ts || Date.now());
        const stamp = `${d.getMonth()+1}/${d.getDate()} ${String(d.getHours()).padStart(2,"0")}:${String(d.getMinutes()).padStart(2,"0")}`;

        const h = (r.time > 0) ? core.hourly(r.amount, r.time) : 0;
        const pm = (r.time > 0) ? core.perMin(r.amount, r.time) : 0;
        const dist = (r.dist != null) ? r.dist : 0;

        return `
          <div class="run-item" data-id="${r.id}">
            <div class="mini">
              <span>${stamp}</span>
              <span>ï¼ˆé…é”æ¸ˆã¿ï¼‰</span>
            </div>

            <div class="grid">
              <div>
                <div class="label">é‡‘é¡</div>
                <input type="text" inputmode="numeric" pattern="[0-9]*" value="${r.amount || 0}" data-f="amount" />
              </div>
              <div>
                <div class="label">æ™‚é–“(åˆ†)</div>
                <input type="text" inputmode="numeric" pattern="[0-9]*" value="${r.time || 0}" data-f="time" />
              </div>
              <div>
                <div class="label">ç¾é‡‘</div>
                <input type="text" inputmode="numeric" pattern="[0-9]*" value="${r.cash || 0}" data-f="cash" />
              </div>
              <div>
                <div class="label">ä»¶æ•°</div>
                <input type="text" inputmode="numeric" pattern="[0-9]*" value="${r.count || 0}" data-f="count" />
              </div>
            </div>

            <div class="optional-row" style="margin-top:6px;">
              <div style="flex:1;">
                <div class="label">è·é›¢(km) â€»ä»»æ„</div>
                <input type="text" inputmode="decimal" value="${dist || 0}" data-f="dist" />
              </div>
            </div>

            <div class="hint">
              <span>æ™‚çµ¦æ›ç®—ï¼šÂ¥${h.toLocaleString()}/h</span>
              <span>åˆ†å˜ä¾¡ï¼šÂ¥${pm.toLocaleString()}/åˆ†</span>
            </div>

            <div class="actions">
              <button class="btn-save" onclick="saveRunEdit('${r.id}')">ä¿å­˜</button>
              <button class="btn-del" onclick="deleteRun('${r.id}')">å‰Šé™¤</button>
            </div>
          </div>
        `;
      }).join("");
    }

    // =========================
    // ç·¨é›†/å‰Šé™¤
    // =========================
    function saveRunEdit(id) {
      const item = document.querySelector(`.run-item[data-id="${id}"]`);
      if (!item) return;

      const get = (f) => core.num(item.querySelector(`[data-f="${f}"]`)?.value);
      const getf = (f) => core.fnum(item.querySelector(`[data-f="${f}"]`)?.value);

      const amount = get("amount");
      const time   = get("time");
      const cash   = get("cash");
      const count  = get("count");
      const dist   = getf("dist");

      if (count <= 0) return;
      if (amount <= 0) return;

      const idx = state.runsLog.findIndex(r => r.id === id);
      if (idx < 0) return;

      const prevCash = core.getCashFromNewEntry(state.runsLog[idx]);
      state.cash += (cash - prevCash);

      const prev = state.runsLog[idx];
      const ts = core.getTsFromNewEntry(prev);
      const key = core.getKeyFromNewEntry(prev);

      let next = {
        id: prev.id,
        date: prev.date,
        minutes: time,
        amount: amount,
        memo: prev.memo
      };

      next = core.updateNewEntryMemo(next, { key, cash, count, ts, time, dist });
      state.runsLog[idx] = next;

      store.save(state);
      calcTotals();

      const h = (time > 0) ? core.hourly(amount, time) : 0;
      const pm = (time > 0) ? core.perMin(amount, time) : 0;
      showToast(`ä¿å­˜ã—ãŸã€‚\næ™‚çµ¦æ›ç®—ï¼šÂ¥${h.toLocaleString()}/hã€€åˆ†å˜ä¾¡ï¼šÂ¥${pm.toLocaleString()}/åˆ†`);
    }

    function deleteRun(id) {
      const idx = state.runsLog.findIndex(r => r.id === id);
      if (idx < 0) return;

      const prevCash = core.getCashFromNewEntry(state.runsLog[idx]);
      state.cash -= prevCash;
      if (state.cash < 0) state.cash = 0;

      state.runsLog.splice(idx, 1);
      store.save(state);
      calcTotals();
      showToast("å‰Šé™¤ã—ãŸã€‚");
    }

    el("dailyNote").addEventListener("input", () => {
      state.note = el("dailyNote").value;
      store.save(state);
    });

    // åˆå›ï¼šãƒ­ãƒ¼ãƒ‰å¾Œã«å†ä¿å­˜ï¼ˆç§»è¡ŒãŒã‚ã£ãŸã‚‰ã“ã“ã§ç¢ºå®šï¼‰
    store.save(state);

    Object.assign(window, {
      addClassRun, addCustom, addQuest, addCash, resetAll,
      toggleRunList, renderRunListIfOpen, renderRunList,
      saveRunEdit, deleteRun,
      setOnline
    });

    // ã‚ªãƒ³ãƒ©ã‚¤ãƒ³è¡¨ç¤ºã¯1ç§’ã”ã¨ã«æ›´æ–°ï¼ˆé‡ããªã‚‰ãªã„ï¼‰
    setInterval(() => {
      const ms = getOnlineMs();
      el("onlineTimeText").textContent = fmtMin(ms);
      // onlineHourly ã¯ totalsä¾å­˜ãªã®ã§ã€ONã®ã¨ãã ã‘è»½ãæ›´æ–°
      if (state.online.isOnline) calcTotals();
    }, 1000);

    calcTotals();
  </script>
</body>
</html>